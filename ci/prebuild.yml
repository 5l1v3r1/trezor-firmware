image: registry.gitlab.com/satoshilabs/trezor/trezor-firmware/environment

style prebuild:
  stage: prebuild
  only:
    changes:
      - ci/**/*
      - "**/*.c"
      - "**/*.h"
      - "**/*.py"
  script:
    - pipenv run make style_check

common prebuild:
  stage: prebuild
  only:
    changes:
      - ci/**/*
      - "**/*.json"
      - "**/*.proto"
  script:
    - pipenv run make defs_check

gen prebuild:
  stage: prebuild
  only:
    changes:
      - ci/**/*
      - "**/*.c"
      - "**/*.h"
      - "**/*.json"
      - "**/*.proto"
      - "**/*.py"
      - "**/*.pyi"
  script:
    - pipenv run make gen_check

xxx:
  stage: prebuild
  variables:
    DEPLOY_PATH: "${DEPLOY_BASE_DIR}/upgrade_tests"
  before_script: []  # no pipenv
  script:
    - rsync --delete -va "trezor-emu-core-v2.3.0" "${DEPLOY_BASE_DIR}/upgrade_tests/trezor-emu-core-v2.3.0"
    - rsync --delete -va "trezor-emu-legacy-v1.9.0" "${DEPLOY_BASE_DIR}/upgrade_tests/trezor-emu-legacy-v1.9.0"
  tags:
    - deploy
